<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÆON | Studio</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body { background: #111; overflow-y: auto; height: auto; min-height: 100vh; padding: 40px 0; display: block; }
        .container { 
            background: #1a1a1a; padding: 30px; border-radius: 24px; border: 1px solid #333; 
            width: 90%; max-width: 550px; margin: 0 auto; display: flex; flex-direction: column; gap: 15px; 
            box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        h1 { margin-bottom: 20px; text-shadow: none; font-size: 24px; text-align: center; color: white;}
        label { color: #888; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; margin-top: 15px; display: block; font-weight: 700; }
        input, textarea { 
            background: #222; border: 1px solid #333; color: white; padding: 16px; border-radius: 12px; width: 100%; box-sizing: border-box; 
            font-family: inherit; font-size: 14px; outline: none; transition: 0.2s;
        }
        input:focus { border-color: #00d2ff; }
        
        /* THEME GRID */
        .theme-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; max-height: 200px; overflow-y: auto; padding: 5px;}
        .theme-btn {
            padding: 15px; border-radius: 12px; cursor: pointer; border: 2px solid transparent; text-align: center;
            font-size: 12px; font-weight: bold; color: #fff; text-shadow: 0 1px 3px rgba(0,0,0,0.8);
            transition: transform 0.2s;
        }
        .theme-btn:hover { transform: scale(1.02); }
        .theme-btn.selected { border-color: #00d2ff; box-shadow: 0 0 15px rgba(0, 210, 255, 0.3); }

        /* AVATARS */
        .avatar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; background: #222; padding: 15px; border-radius: 12px; }
        .avatar-option { width: 100%; border-radius: 50%; cursor: pointer; transition: 0.2s; border: 2px solid transparent; background: #fff;}
        .avatar-option:hover { transform: scale(1.1); }
        .avatar-option.selected { border-color: #00d2ff; box-shadow: 0 0 10px #00d2ff; }

        .link-row { display: flex; gap: 10px; }
        
        button#saveBtn {
            background: linear-gradient(90deg, #00d2ff, #007bff); border: none; padding: 18px; color: white; font-weight: bold;
            border-radius: 12px; margin-top: 20px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; width: 100%;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ÆON Studio</h1>
        <div id="loading" style="text-align:center; color:#00d2ff; font-size: 12px;">NAČÍTÁM DATA...</div>

        <label>URL (Slug)</label>
        <input type="text" id="slug" placeholder="např. ondra" required>

        <label>Vyber Tapetu (Styl)</label>
        <div class="theme-grid" id="themeGrid">
            </div>
        <input type="hidden" id="selectedTheme" value="winter-night">

        <label>Jméno</label>
        <input type="text" id="name" placeholder="Jan Novák">
        <label>Bio</label>
        <input type="text" id="bio" placeholder="Digital Creator">
        <label>Motto (Zlatý text na pozadí)</label>
        <input type="text" id="motto" placeholder="FUTURE IS NOW">

        <label>Avatar</label>
        <div class="avatar-grid" id="avatarStudio"></div>
        <div style="text-align:center; font-size:10px; color:#555; margin: 5px 0;">NEBO NAHRAJ VLASTNÍ</div>
        <input type="file" id="photoInput" accept="image/*">
        <input type="hidden" id="base64String">
        <img id="preview" style="width:50px; height:50px; border-radius:50%; margin: 10px auto; display:block; object-fit:cover; border: 1px solid #333;">

        <label>Odkazy</label>
        <div id="linksContainer" style="display:flex; flex-direction:column; gap:10px;"></div>
        <button onclick="addLinkField()" style="background:#222; border:1px solid #333; padding: 10px; border-radius: 8px; color: #888; cursor: pointer; margin-top:10px; width:100%;">+ Přidat</button>

        <button onclick="saveCard()" id="saveBtn">ULOŽIT KARTU</button>
        <div id="status" style="text-align:center; margin-top:10px; color: yellow;"></div>
    </div>

    <script>
        // 1. THEMES (Z "Můj Start")
        const themes = [
            { id: "spring-morning", name: "Jaro - Ráno", bg: "linear-gradient(45deg, #f3ffe3, #fff0f5)" },
            { id: "spring-night", name: "Jaro - Noc", bg: "linear-gradient(45deg, #2c3a47, #58b19f)" },
            { id: "summer-noon", name: "Léto - Poledne", bg: "linear-gradient(45deg, #f9ca24, #f0932b)" },
            { id: "summer-night", name: "Léto - Noc", bg: "linear-gradient(45deg, #130f40, #30336b)" },
            { id: "autumn-evening", name: "Podzim - Večer", bg: "linear-gradient(45deg, #ffda79, #ffb142)" },
            { id: "autumn-night", name: "Podzim - Noc", bg: "linear-gradient(45deg, #2d3436, #0f0c29)" },
            { id: "winter-morning", name: "Zima - Ráno", bg: "linear-gradient(45deg, #f1f2f6, #dfe4ea)" },
            { id: "winter-night", name: "Zima - Noc", bg: "linear-gradient(45deg, #0c2461, #1e3799)" }
        ];

        const themeContainer = document.getElementById('themeGrid');
        themes.forEach(t => {
            const div = document.createElement('div');
            div.className = 'theme-btn';
            div.innerText = t.name;
            div.style.background = t.bg;
            if(t.id.includes('night')) div.style.color = 'white'; else div.style.color = '#333';
            div.onclick = () => selectTheme(t.id, div);
            themeContainer.appendChild(div);
        });

        function selectTheme(id, el) {
            document.getElementById('selectedTheme').value = id;
            document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
            el.classList.add('selected');
        }

        // 2. AVATARS (Notionists - Profi a čisté)
        const seeds = ["Leo", "Mila", "Caleb", "Eliza", "Chase", "Jade", "Nora", "Jack", "Felix", "Ruby"];
        const avContainer = document.getElementById('avatarStudio');
        seeds.forEach(s => {
            const img = document.createElement('img');
            const url = `https://api.dicebear.com/7.x/notionists/svg?seed=${s}&backgroundColor=transparent`;
            img.src = url;
            img.className = 'avatar-option';
            img.onclick = () => {
                document.getElementById('base64String').value = url;
                document.getElementById('preview').src = url;
                document.querySelectorAll('.avatar-option').forEach(x => x.classList.remove('selected'));
                img.classList.add('selected');
            };
            avContainer.appendChild(img);
        });

        // 3. LOAD
        const linksWrapper = document.getElementById('linksContainer');
        function addLinkField(l="", u="") {
            const d = document.createElement('div'); d.className = 'link-row';
            d.innerHTML = `<input class="l-lbl" placeholder="Název" value="${l}"><input class="l-url" placeholder="URL" value="${u}">`;
            linksWrapper.appendChild(d);
        }

        window.onload = async function() {
            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            if(slug) {
                document.getElementById('slug').value = slug;
                document.getElementById('saveBtn').innerText = "AKTUALIZOVAT";
                try {
                    const res = await fetch(`/.netlify/functions/aeon-api?slug=${slug}`);
                    if(res.ok) {
                        const d = await res.json();
                        document.getElementById('name').value = d.name || "";
                        document.getElementById('bio').value = d.bio || "";
                        document.getElementById('motto').value = d.motto || "";
                        if(d.theme) {
                            document.getElementById('selectedTheme').value = d.theme;
                            // Highlight button logic would go here
                        }
                        if(d.avatar) {
                            document.getElementById('base64String').value = d.avatar;
                            document.getElementById('preview').src = d.avatar;
                        }
                        linksWrapper.innerHTML = '';
                        if(d.links) d.links.forEach(x => addLinkField(x.label, x.url));
                        if(!d.links || d.links.length === 0) { addLinkField(); addLinkField(); }
                    }
                } catch(e){}
            } else { addLinkField(); addLinkField(); }
            document.getElementById('loading').style.display = 'none';
        }

        // 4. SAVE
        async function saveCard() {
            const stat = document.getElementById('status'); stat.innerText = "Ukládám...";
            const slug = document.getElementById('slug').value.toLowerCase().replace(/\s+/g, '-');
            const links = [];
            document.querySelectorAll('.link-row').forEach(r => {
                const l = r.querySelector('.l-lbl').value; const u = r.querySelector('.l-url').value;
                if(l && u) links.push({label: l, url: u});
            });

            const payload = {
                data: {
                    slug: slug,
                    name: document.getElementById('name').value,
                    bio: document.getElementById('bio').value,
                    motto: document.getElementById('motto').value,
                    theme: document.getElementById('selectedTheme').value,
                    avatar: document.getElementById('base64String').value,
                    links: links
                }
            };

            try {
                await fetch('/.netlify/functions/aeon-api', { method: 'POST', body: JSON.stringify(payload) });
                stat.innerText = "HOTOVO!"; stat.style.color = "#0f0";
                setTimeout(() => window.location.href = `/?slug=${slug}`, 1500);
            } catch(e) { stat.innerText = "CHYBA"; }
        }

        // Photo Upload
        document.getElementById('photoInput').addEventListener('change', function(e) {
            const file = e.target.files[0]; if(!file) return;
            const r = new FileReader();
            r.onload = function(ev) {
                const i = new Image(); i.onload = function() {
                    const c = document.createElement('canvas'); const x = c.getContext('2d');
                    const m = 500; let w=i.width, h=i.height;
                    if(w>h){if(w>m){h*=m/w;w=m}}else{if(h>m){w*=m/h;h=m}}
                    c.width=w; c.height=h; x.drawImage(i,0,0,w,h);
                    const d = c.toDataURL('image/jpeg',0.8);
                    document.getElementById('preview').src=d; document.getElementById('base64String').value=d;
                }; i.src = ev.target.result;
            }; r.readAsDataURL(file);
        });
    </script>
</body>
</html>