<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ã†ON | Studio</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
</head>
<body>

    <div class="lang-wrapper">
        <select id="langSelect" class="lang-select" onchange="changeAdminLang(this.value)">
            <option value="en">ğŸ‡ºğŸ‡¸ English</option>
            <option value="cs">ğŸ‡¨ğŸ‡¿ ÄŒeÅ¡tina</option>
            <option value="de">ğŸ‡©ğŸ‡ª Deutsch</option>
            <option value="es">ğŸ‡ªğŸ‡¸ EspaÃ±ol</option>
            <option value="fr">ğŸ‡«ğŸ‡· FranÃ§ais</option>
            <option value="it">ğŸ‡®ğŸ‡¹ Italiano</option>
            <option value="pl">ğŸ‡µğŸ‡± Polski</option>
            <option value="ru">ğŸ‡·ğŸ‡º Ğ ÑƒÑÑĞºĞ¸Ğ¹</option>
            <option value="ua">ğŸ‡ºğŸ‡¦ Ğ£ĞºÑ€Ğ°Ñ—Ğ½ÑÑŒĞºĞ°</option>
            <option value="ja">ğŸ‡¯ğŸ‡µ æ—¥æœ¬èª</option>
        </select>
    </div>

    <div class="fixed-background">
        <div class="orb orb-1"></div><div class="orb orb-2"></div><div class="orb orb-3"></div><div class="orb orb-4"></div>
    </div>

    <div class="admin-container">
        <h1 style="color: var(--text-main); text-align: center;">Ã†ON Studio</h1>
        <div id="loading" style="text-align:center; color:var(--accent); font-size: 12px;">LOADING...</div>

        <label class="admin-label" data-i18n="slug_label">URL (Slug)</label>
        <input type="text" class="admin-input" id="slug" placeholder="e.g. john-doe" required>

        <label class="admin-label" data-i18n="theme_label">Atmosphere</label>
        <div class="theme-grid" id="themeGrid"></div>
        <input type="hidden" id="selectedTheme" value="winter-night">

        <label class="admin-label" data-i18n="identity_label">Identity</label>
        <input type="text" class="admin-input" id="name" placeholder="Name">
        <input type="text" class="admin-input" id="bio" placeholder="Bio" style="margin-top:5px;">
        <input type="text" class="admin-input" id="motto" placeholder="Motto" style="margin-top:5px;">

        <label class="admin-label" data-i18n="avatar_label">Avatar</label>
        <div class="avatar-grid" id="avatarStudio"></div>
        
        <div class="file-upload-wrapper">
            <label for="photoInput" class="custom-file-upload">
                <i class="fa-solid fa-cloud-arrow-up"></i> <span data-i18n="avatar_upload">Upload Photo</span>
            </label>
            <input type="file" id="photoInput" accept="image/*">
        </div>
        
        <input type="hidden" id="base64String">
        <img id="preview" style="width:50px; height:50px; border-radius:50%; margin: 10px auto; display:block; object-fit:cover; border: 2px solid var(--accent);">

        <label class="admin-label" data-i18n="social_label">Social Hub</label>
        <div class="social-grid" id="socialGrid"></div>
        <div id="activeSocialsContainer"></div>

        <label class="admin-label" data-i18n="other_links_label">Other Links</label>
        <div id="linksContainer"></div>
        <button onclick="addLinkField()" id="addLinkBtn" style="background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; color: var(--text-main); cursor: pointer; margin-top:10px; width:100%;">+ Custom Link</button>

        <button onclick="saveCard()" id="saveBtn" style="background: var(--accent); border: none; padding: 16px; color: #000; font-weight: bold; border-radius: 12px; margin-top: 20px; cursor: pointer; width: 100%;">SAVE CARD</button>
        <div id="status" style="text-align:center; margin-top:10px; color: yellow; text-shadow: 0 1px 2px black; font-weight:bold;"></div>
    </div>

    <script>
        // --- ADMIN SLOVNÃK (10 JAZYKÅ®) ---
        const i18n = {
            en: { slug_label: "URL Slug", theme_label: "Atmosphere", identity_label: "Identity", avatar_label: "Avatar", avatar_upload: "Upload Photo", social_label: "Social Hub", other_links_label: "Custom Links", save: "SAVE CARD", done: "DONE!", error: "ERROR", fill_name: "Please fill link name!", social_ph: "username", name_ph: "Name", bio_ph: "Bio", motto_ph: "Motto", link_name: "Title", link_url: "https://..." },
            cs: { slug_label: "URL Adresa", theme_label: "AtmosfÃ©ra", identity_label: "Identita", avatar_label: "Avatar", avatar_upload: "NahrÃ¡t fotku", social_label: "SociÃ¡lnÃ­ sÃ­tÄ›", other_links_label: "VlastnÃ­ odkazy", save: "ULOÅ½IT KARTU", done: "HOTOVO!", error: "CHYBA", fill_name: "VyplÅˆ nÃ¡zev odkazu!", social_ph: "uÅ¾ivatel", name_ph: "JmÃ©no", bio_ph: "Bio", motto_ph: "Motto", link_name: "NÃ¡zev", link_url: "https://..." },
            de: { slug_label: "URL-Slug", theme_label: "AtmosphÃ¤re", identity_label: "IdentitÃ¤t", avatar_label: "Avatar", avatar_upload: "Foto hochladen", social_label: "Sozial", other_links_label: "Andere Links", save: "SPEICHERN", done: "FERTIG!", error: "FEHLER", fill_name: "Linknamen eingeben!", social_ph: "benutzer", name_ph: "Name", bio_ph: "Bio", motto_ph: "Motto", link_name: "Titel", link_url: "https://..." },
            es: { slug_label: "URL Slug", theme_label: "AtmÃ³sfera", identity_label: "Identidad", avatar_label: "Avatar", avatar_upload: "Subir foto", social_label: "Redes", other_links_label: "Enlaces", save: "GUARDAR", done: "HECHO!", error: "ERROR", fill_name: "Â¡Nombre del enlace!", social_ph: "usuario", name_ph: "Nombre", bio_ph: "Bio", motto_ph: "Lema", link_name: "TÃ­tulo", link_url: "https://..." },
            fr: { slug_label: "Slug URL", theme_label: "AtmosphÃ¨re", identity_label: "IdentitÃ©", avatar_label: "Avatar", avatar_upload: "TÃ©lÃ©charger", social_label: "RÃ©seaux", other_links_label: "Liens", save: "ENREGISTRER", done: "FAIT!", error: "ERREUR", fill_name: "Nom du lien!", social_ph: "utilisateur", name_ph: "Nom", bio_ph: "Bio", motto_ph: "Devise", link_name: "Titre", link_url: "https://..." },
            it: { slug_label: "Slug URL", theme_label: "Atmosfera", identity_label: "IdentitÃ ", avatar_label: "Avatar", avatar_upload: "Carica foto", social_label: "Social", other_links_label: "Link", save: "SALVA", done: "FATTO!", error: "ERRORE", fill_name: "Nome del link!", social_ph: "utente", name_ph: "Nome", bio_ph: "Bio", motto_ph: "Motto", link_name: "Titolo", link_url: "https://..." },
            pl: { slug_label: "Adres URL", theme_label: "Atmosfera", identity_label: "ToÅ¼samoÅ›Ä‡", avatar_label: "Awatar", avatar_upload: "PrzeÅ›lij zdjÄ™cie", social_label: "SpoÅ‚ecznoÅ›Ä‡", other_links_label: "Linki", save: "ZAPISZ", done: "GOTOWE!", error: "BÅÄ„D", fill_name: "Nazwa linku!", social_ph: "uÅ¼ytkownik", name_ph: "ImiÄ™", bio_ph: "Bio", motto_ph: "Motto", link_name: "TytuÅ‚", link_url: "https://..." },
            ru: { slug_label: "URL ĞĞ´Ñ€ĞµÑ", theme_label: "ĞÑ‚Ğ¼Ğ¾ÑÑ„ĞµÑ€Ğ°", identity_label: "Ğ›Ğ¸Ñ‡Ğ½Ğ¾ÑÑ‚ÑŒ", avatar_label: "ĞĞ²Ğ°Ñ‚Ğ°Ñ€", avatar_upload: "Ğ—Ğ°Ğ³Ñ€ÑƒĞ·Ğ¸Ñ‚ÑŒ Ñ„Ğ¾Ñ‚Ğ¾", social_label: "Ğ¡Ğ¾Ñ†ÑĞµÑ‚Ğ¸", other_links_label: "Ğ¡ÑÑ‹Ğ»ĞºĞ¸", save: "Ğ¡ĞĞ¥Ğ ĞĞĞ˜Ğ¢Ğ¬", done: "Ğ“ĞĞ¢ĞĞ’Ğ!", error: "ĞĞ¨Ğ˜Ğ‘ĞšĞ", fill_name: "Ğ˜Ğ¼Ñ ÑÑÑ‹Ğ»ĞºĞ¸!", social_ph: "Ğ¸Ğ¼Ñ", name_ph: "Ğ˜Ğ¼Ñ", bio_ph: "Ğ‘Ğ¸Ğ¾", motto_ph: "Ğ”ĞµĞ²Ğ¸Ğ·", link_name: "ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ", link_url: "https://..." },
            ua: { slug_label: "URL ĞĞ´Ñ€ĞµÑĞ°", theme_label: "ĞÑ‚Ğ¼Ğ¾ÑÑ„ĞµÑ€Ğ°", identity_label: "ĞÑĞ¾Ğ±Ğ¸ÑÑ‚Ñ–ÑÑ‚ÑŒ", avatar_label: "ĞĞ²Ğ°Ñ‚Ğ°Ñ€", avatar_upload: "Ğ—Ğ°Ğ²Ğ°Ğ½Ñ‚Ğ°Ğ¶Ğ¸Ñ‚Ğ¸", social_label: "Ğ¡Ğ¾Ñ†Ğ¼ĞµÑ€ĞµĞ¶Ñ–", other_links_label: "ĞŸĞ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ", save: "Ğ—Ğ‘Ğ•Ğ Ğ•Ğ“Ğ¢Ğ˜", done: "Ğ“ĞĞ¢ĞĞ’Ğ!", error: "ĞŸĞĞœĞ˜Ğ›ĞšĞ", fill_name: "ĞĞ°Ğ·Ğ²Ğ° Ğ¿Ğ¾ÑĞ¸Ğ»Ğ°Ğ½Ğ½Ñ!", social_ph: "Ñ–Ğ¼'Ñ", name_ph: "Ğ†Ğ¼'Ñ", bio_ph: "Ğ‘Ñ–Ğ¾", motto_ph: "Ğ”ĞµĞ²Ñ–Ğ·", link_name: "ĞĞ°Ğ·Ğ²Ğ°", link_url: "https://..." },
            ja: { slug_label: "URLã‚¹ãƒ©ãƒƒã‚°", theme_label: "é›°å›²æ°—", identity_label: "ã‚¢ã‚¤ãƒ‡ãƒ³ãƒ†ã‚£ãƒ†ã‚£", avatar_label: "ã‚¢ãƒã‚¿ãƒ¼", avatar_upload: "å†™çœŸã‚’ã‚¢ãƒƒãƒ—", social_label: "ã‚½ãƒ¼ã‚·ãƒ£ãƒ«", other_links_label: "ãƒªãƒ³ã‚¯", save: "ä¿å­˜ã™ã‚‹", done: "å®Œäº†ï¼", error: "ã‚¨ãƒ©ãƒ¼", fill_name: "ãƒªãƒ³ã‚¯åï¼", social_ph: "ãƒ¦ãƒ¼ã‚¶ãƒ¼å", name_ph: "åå‰", bio_ph: "è‡ªå·±ç´¹ä»‹", motto_ph: "ãƒ¢ãƒƒãƒˆãƒ¼", link_name: "ã‚¿ã‚¤ãƒˆãƒ«", link_url: "https://..." }
        };

        let currentLang = 'en';

        function changeAdminLang(lang) {
            currentLang = lang;
            const t = i18n[lang];
            // Labels
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if(t[key]) el.innerText = t[key];
            });
            // Placeholders & Buttons
            document.getElementById('saveBtn').innerText = t.save;
            document.getElementById('addLinkBtn').innerText = "+ " + t.other_links_label;
            document.getElementById('name').placeholder = t.name_ph;
            document.getElementById('bio').placeholder = t.bio_ph;
            document.getElementById('motto').placeholder = t.motto_ph;
            
            // Inputy
            document.querySelectorAll('.social-input').forEach(i => {
                if(!i.closest('.mode-url')) i.placeholder = t.social_ph;
            });
            document.querySelectorAll('.l-lbl').forEach(i => i.placeholder = t.link_name);
        }

        // --- PLATFORMS ---
        const platforms = {
            instagram: { icon: 'fa-instagram', prefix: 'instagram.com/', url: 'https://instagram.com/', label: 'Instagram' },
            facebook:  { icon: 'fa-facebook-f', prefix: 'facebook.com/', url: 'https://facebook.com/', label: 'Facebook' },
            tiktok:    { icon: 'fa-tiktok', prefix: 'tiktok.com/@', url: 'https://tiktok.com/@', label: 'TikTok' },
            youtube:   { icon: 'fa-youtube', prefix: 'youtube.com/@', url: 'https://youtube.com/@', label: 'YouTube' },
            twitter:   { icon: 'fa-x-twitter', prefix: 'x.com/', url: 'https://x.com/', label: 'X' },
            linkedin:  { icon: 'fa-linkedin-in', prefix: 'linkedin.com/in/', url: 'https://linkedin.com/in/', label: 'LinkedIn' },
            twitch:    { icon: 'fa-twitch', prefix: 'twitch.tv/', url: 'https://twitch.tv/', label: 'Twitch' },
            discord:   { icon: 'fa-discord', prefix: 'discord.gg/', url: 'https://discord.gg/', label: 'Discord' },
            pinterest: { icon: 'fa-pinterest', prefix: 'pinterest.com/', url: 'https://pinterest.com/', label: 'Pinterest' },
            reddit:    { icon: 'fa-reddit-alien', prefix: 'reddit.com/user/', url: 'https://reddit.com/user/', label: 'Reddit' },
            snapchat:  { icon: 'fa-snapchat', prefix: 'snapchat.com/add/', url: 'https://snapchat.com/add/', label: 'Snapchat' },
            threads:   { icon: 'fa-brands fa-threads', prefix: 'threads.net/@', url: 'https://threads.net/@', label: 'Threads' }
        };

        const socialGrid = document.getElementById('socialGrid');
        for (const [key, p] of Object.entries(platforms)) {
            const btn = document.createElement('button');
            btn.className = 'social-icon-btn';
            btn.onclick = () => addSocial(key);
            btn.innerHTML = `<i class="fa-brands ${p.icon}"></i>`;
            socialGrid.appendChild(btn);
        }

        const activeSocialsDiv = document.getElementById('activeSocialsContainer');

        function addSocial(type, value = "", isFullUrl = false) {
            if(document.querySelector(`.social-input[data-type="${type}"]`)) return;
            const p = platforms[type];
            const div = document.createElement('div');
            div.className = 'active-social-row';
            if(isFullUrl) div.classList.add('mode-url'); 

            div.innerHTML = `
                <i class="fa-brands ${p.icon}" style="font-size:18px; width:25px; text-align:center;"></i>
                <div class="input-wrapper">
                    <span class="social-prefix">${p.prefix}</span>
                    <input class="social-input" type="text" placeholder="${i18n[currentLang].social_ph}" data-type="${type}" value="${value}">
                </div>
                <div class="action-group">
                    <button class="mini-btn ${isFullUrl ? 'active' : ''} toggle-mode" onclick="toggleMode(this)"><i class="fa-solid fa-link"></i></button>
                    <button class="mini-btn" onclick="testSocialLink(this, '${type}')"><i class="fa-solid fa-arrow-up-right-from-square"></i></button>
                    <button class="mini-btn remove" onclick="this.closest('.active-social-row').remove()"><i class="fas fa-times"></i></button>
                </div>
            `;
            activeSocialsDiv.appendChild(div);
            
            const input = div.querySelector('.social-input');
            input.addEventListener('input', () => validateRow(div, input.value, type));
            if(value) validateRow(div, value, type);
        }

        function validateRow(row, val, type) {
            val = val.trim();
            row.classList.remove('valid', 'invalid'); 
            if(val.length === 0) return;
            const isUrlMode = row.classList.contains('mode-url');
            if (isUrlMode) {
                const domainCheck = type === 'twitter' ? (val.includes('x.com') || val.includes('twitter.com')) : val.includes(type);
                if (val.startsWith('http') && domainCheck) row.classList.add('valid'); else row.classList.add('invalid');
            } else {
                if (val.includes(' ') || val.includes('/') || val.includes('.' + type) || val.includes('http')) row.classList.add('invalid');
                else row.classList.add('valid');
            }
        }

        function toggleMode(btn) {
            const row = btn.closest('.active-social-row');
            const input = row.querySelector('.social-input');
            const type = input.getAttribute('data-type');
            row.classList.toggle('mode-url');
            btn.classList.toggle('active');
            if (row.classList.contains('mode-url')) input.placeholder = "https://...";
            else input.placeholder = i18n[currentLang].social_ph;
            input.focus();
            validateRow(row, input.value, type);
        }

        function testSocialLink(btn, type) {
            const row = btn.closest('.active-social-row');
            const val = row.querySelector('.social-input').value.trim();
            if(!val) return;
            let finalUrl = row.classList.contains('mode-url') ? val : platforms[type].url + val.replace('@', '');
            if(row.classList.contains('mode-url') && !finalUrl.startsWith('http')) finalUrl = 'https://' + finalUrl;
            window.open(finalUrl, '_blank');
        }

        const linksWrapper = document.getElementById('linksContainer');
        function addLinkField(l="", u="") {
            const d = document.createElement('div'); d.className = 'link-row';
            d.innerHTML = `
                <input class="admin-input l-lbl" placeholder="${i18n[currentLang].link_name}" value="${l}" style="width:40%"> 
                <input class="admin-input l-url" placeholder="${i18n[currentLang].link_url}" value="${u}" style="width:60%"> 
                <i class="fas fa-times remove-social" style="margin-top:10px;" onclick="this.parentElement.remove()"></i>`;
            linksWrapper.appendChild(d);
        }

        async function saveCard() {
            const stat = document.getElementById('status'); 
            
            // VALIDACE VLASTNÃCH ODKAZÅ®
            let valid = true;
            document.querySelectorAll('.link-row').forEach(r => {
                const lblInput = r.querySelector('.l-lbl');
                const urlInput = r.querySelector('.l-url');
                lblInput.classList.remove('error');
                if (urlInput.value.trim() !== "" && lblInput.value.trim() === "") {
                    lblInput.classList.add('error');
                    valid = false;
                }
            });

            if (!valid) {
                alert(i18n[currentLang].fill_name);
                stat.innerText = i18n[currentLang].error;
                return; 
            }

            stat.innerText = "UklÃ¡dÃ¡m...";
            const slug = document.getElementById('slug').value.toLowerCase().replace(/\s+/g, '-');
            const links = [];

            document.querySelectorAll('.active-social-row').forEach(row => {
                const input = row.querySelector('.social-input');
                const type = input.getAttribute('data-type');
                let val = input.value.trim();
                if(val) {
                    let finalUrl = row.classList.contains('mode-url') ? val : platforms[type].url + val.replace('@', '');
                    if(row.classList.contains('mode-url') && !finalUrl.startsWith('http')) finalUrl = 'https://' + finalUrl;
                    links.push({ label: platforms[type].label, url: finalUrl });
                }
            });

            document.querySelectorAll('.link-row').forEach(r => {
                const l = r.querySelector('.l-lbl').value; const u = r.querySelector('.l-url').value;
                if(l && u) links.push({label: l, url: u});
            });

            const payload = {
                data: {
                    slug: slug, name: document.getElementById('name').value,
                    bio: document.getElementById('bio').value, motto: document.getElementById('motto').value,
                    theme: document.getElementById('selectedTheme').value,
                    avatar: document.getElementById('base64String').value, links: links
                }
            };

            try {
                await fetch('/api/aeon-api', { method: 'POST', body: JSON.stringify(payload) });
                stat.innerText = i18n[currentLang].done; stat.style.color = "#0f0";
                setTimeout(() => window.location.href = `/?slug=${slug}`, 1500);
            } catch(e) { stat.innerText = i18n[currentLang].error; }
        }

        window.onload = async function() {
            // DETEKCE JAZYKA
            const userLang = (navigator.language || 'en').substring(0,2);
            if(i18n[userLang]) {
                document.getElementById('langSelect').value = userLang;
                changeAdminLang(userLang);
            }

            const params = new URLSearchParams(window.location.search);
            const slug = params.get('slug');
            if(slug) {
                document.getElementById('slug').value = slug;
                try {
                    const res = await fetch(`/api/aeon-api?slug=${slug}`);
                    if(res.ok) {
                        const d = await res.json();
                        document.getElementById('name').value = d.name || "";
                        document.getElementById('bio').value = d.bio || "";
                        document.getElementById('motto').value = d.motto || "";
                        
                        if(d.theme) {
                            const btn = Array.from(document.querySelectorAll('.theme-btn')).find(b => b.innerText.includes(d.theme.split('-')[1].charAt(0).toUpperCase())); 
                            if(btn) btn.click();
                        } else { 
                            const def = document.querySelector('.theme-btn'); if(def) def.click();
                        }

                        if(d.avatar) { document.getElementById('base64String').value = d.avatar; document.getElementById('preview').src = d.avatar; }
                        
                        activeSocialsDiv.innerHTML = '';
                        linksWrapper.innerHTML = '';
                        
                        if(d.links) {
                            d.links.forEach(x => {
                                let found = false;
                                for (const [key, p] of Object.entries(platforms)) {
                                    if (x.url.startsWith(p.url)) {
                                        addSocial(key, x.url.replace(p.url, ''), false); found = true; break;
                                    } else if (x.url.includes(key) || (key==='twitter' && x.url.includes('x.com'))) {
                                        addSocial(key, x.url, true); found = true; break;
                                    }
                                }
                                if (!found) addLinkField(x.label, x.url);
                            });
                        }
                    }
                } catch(e){}
            } else {
                const def = document.querySelector('.theme-btn'); if(def) def.click();
            }
            document.getElementById('loading').style.display = 'none';
        }

        // TÃ©mata (GenerovÃ¡nÃ­)
        const themes = [
            { id: "spring-morning", name: "Jaro RÃ¡no", bg: "#f3ffe3" }, { id: "spring-noon", name: "Jaro Poledne", bg: "#badc58" },
            { id: "spring-evening", name: "Jaro VeÄer", bg: "#e056fd", dark:true }, { id: "spring-night", name: "Jaro Noc", bg: "#2c3a47", dark:true },
            { id: "summer-morning", name: "LÃ©to RÃ¡no", bg: "#81ecec" }, { id: "summer-noon", name: "LÃ©to Poledne", bg: "#f9ca24" },
            { id: "summer-evening", name: "LÃ©to VeÄer", bg: "#eb4d4b", dark:true }, { id: "summer-night", name: "LÃ©to Noc", bg: "#130f40", dark:true },
            { id: "autumn-morning", name: "Podzim RÃ¡no", bg: "#d1ccc0" }, { id: "autumn-noon", name: "Podzim Poledne", bg: "#ffdbcc" },
            { id: "autumn-evening", name: "Podzim VeÄer", bg: "#e17055", dark:true }, { id: "autumn-night", name: "Podzim Noc", bg: "#2d3436", dark:true },
            { id: "winter-morning", name: "Zima RÃ¡no", bg: "#dfe4ea" }, { id: "winter-noon", name: "Zima Poledne", bg: "#bbdefb" },
            { id: "winter-evening", name: "Zima VeÄer", bg: "#a29bfe", dark:true }, { id: "winter-night", name: "Zima Noc", bg: "#0c2461", dark:true }
        ];
        const themeContainer = document.getElementById('themeGrid');
        themes.forEach(t => {
            const div = document.createElement('div');
            div.className = 'theme-btn' + (t.dark ? ' dark-text' : '');
            div.innerText = t.name; div.style.background = t.bg;
            div.onclick = () => {
                document.getElementById('selectedTheme').value = t.id;
                document.querySelectorAll('.theme-btn').forEach(b => b.classList.remove('selected'));
                div.classList.add('selected');
                document.body.className = ''; const parts = t.id.split('-'); document.body.classList.add(parts[0]); document.body.classList.add(parts[1]);
            };
            themeContainer.appendChild(div);
        });

        // AvataÅ™i
        const seeds = ["Leo", "Mila", "Caleb", "Eliza", "Chase", "Jade", "Nora", "Jack", "Felix", "Ruby"];
        const avContainer = document.getElementById('avatarStudio');
        seeds.forEach(s => {
            const img = document.createElement('img');
            const url = `https://api.dicebear.com/7.x/notionists/svg?seed=${s}&backgroundColor=transparent`;
            img.src = url; img.className = 'avatar-option';
            img.onclick = () => {
                document.getElementById('base64String').value = url; document.getElementById('preview').src = url;
                document.querySelectorAll('.avatar-option').forEach(x => x.classList.remove('selected')); img.classList.add('selected');
            };
            avContainer.appendChild(img);
        });

        document.getElementById('photoInput').addEventListener('change', function(e) {
            const file = e.target.files[0]; if(!file) return;
            const r = new FileReader();
            r.onload = function(ev) {
                const i = new Image(); i.onload = function() {
                    const c = document.createElement('canvas'); const x = c.getContext('2d');
                    const m = 500; let w=i.width, h=i.height;
                    if(w>h){if(w>m){h*=m/w;w=m}}else{if(h>m){w*=m/h;h=m}}
                    c.width=w; c.height=h; x.drawImage(i,0,0,w,h);
                    const d = c.toDataURL('image/jpeg',0.8);
                    document.getElementById('preview').src=d; document.getElementById('base64String').value=d;
                }; i.src = ev.target.result;
            }; r.readAsDataURL(file);
        });
    </script>
</body>
</html>